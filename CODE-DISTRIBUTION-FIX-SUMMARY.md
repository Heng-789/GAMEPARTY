# ЁЯУЛ р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕гр╕░р╕Ър╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╕Бр╣Вр╕Др╣Йр╕Ф

## тЬЕ р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Чр╕│р╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з

### 1. Backend Endpoints

#### тЬЕ `/api/games/:gameId/claim-code` (р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╣Бр╕ер╣Йр╕з)
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╣Йр╕Фр╕Лр╣Йр╕│р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З USER
- тЬЕ р╕лр╕▓р╣Вр╕Др╣Йр╕Фр╕Цр╕▒р╕Фр╣Др╕Ыр╕Цр╣Йр╕▓р╣Вр╕Др╣Йр╕Фр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Цр╕╣р╕Бр╣Бр╕Ир╕Бр╣Др╕Ыр╣Бр╕ер╣Йр╕з
- тЬЕ р╣Гр╕Кр╣Й FOR UPDATE lock
- тЬЕ р╣Гр╕Кр╣Й Transaction

#### тЬЕ `/api/games/:gameId/claim-code/big-prize` (р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И)
- тЬЕ р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╕бр╕ер╕нр╕вр╕Бр╕гр╕░р╕Чр╕З (bigPrizeCodes)
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╣Йр╕Фр╕Лр╣Йр╕│р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З USER
- тЬЕ р╣Бр╕Ир╕Бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ъ

#### тЬЕ `/api/games/:gameId/claim-code/daily-reward/:dayIndex` (р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И)
- тЬЕ р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╕бр╣Ар╕Кр╣Зр╕Др╕нр╕┤р╕Щ (dailyRewardCodes)
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╣Йр╕Фр╕Лр╣Йр╕│р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З USER
- тЬЕ р╣Бр╕Ир╕Бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ъ

#### тЬЕ `/api/games/:gameId/claim-code/complete-reward` (р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И)
- тЬЕ р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╕бр╣Ар╕Кр╣Зр╕Др╕нр╕┤р╕Щ (completeRewardCodes)
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╣Йр╕Фр╕Лр╣Йр╕│р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З USER
- тЬЕ р╣Бр╕Ир╕Бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ъ

#### тЬЕ `/api/games/:gameId/claim-code/coupon/:itemIndex` (р╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣И)
- тЬЕ р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╕бр╣Ар╕Кр╣Зр╕Др╕нр╕┤р╕Щ (couponItemCodes)
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╣Йр╕Фр╕Лр╣Йр╕│р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З USER
- тЬЕ р╣Бр╕Ир╕Бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ъ

---

### 2. Frontend API Functions

#### тЬЕ `postgresql-api.ts`
- тЬЕ `claimCode()`
- тЬЕ `claimBigPrizeCode()`
- тЬЕ `claimDailyRewardCode()`
- тЬЕ `claimCompleteRewardCode()`
- тЬЕ `claimCouponCode()`

#### тЬЕ `postgresql-adapter.ts`
- тЬЕ `claimCode()`
- тЬЕ `claimBigPrizeCode()`
- тЬЕ `claimDailyRewardCode()`
- тЬЕ `claimCompleteRewardCode()`
- тЬЕ `claimCouponCode()`

---

## тП│ р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Чр╕│р╕Хр╣Ир╕н

### 1. р╣Бр╕Бр╣Йр╣Др╕В Frontend Components

#### тЭМ р╣Ар╕Бр╕б BINGO (`src/components/BingoGame.tsx`)
- **р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ:** р╣Гр╕Кр╣Й Firebase transaction р╣Вр╕Фр╕вр╕Хр╕гр╕З
- **р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Й:** р╣Гр╕Кр╣Й `postgresqlAdapter.claimCode()`

#### тЭМ р╣Ар╕Бр╕бр╕ер╕нр╕вр╕Бр╕гр╕░р╕Чр╕З (`src/components/LoyKrathongGame.tsx`)
- **р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ:** р╣Гр╕Кр╣Й Firebase transaction р╣Вр╕Фр╕вр╕Хр╕гр╕З
- **р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Й:** 
  - р╣Гр╕Кр╣Й `postgresqlAdapter.claimCode()` р╕кр╕│р╕лр╕гр╕▒р╕Ъ codes р╕Шр╕гр╕гр╕бр╕Фр╕▓
  - р╣Гр╕Кр╣Й `postgresqlAdapter.claimBigPrizeCode()` р╕кр╕│р╕лр╕гр╕▒р╕Ъ bigPrizeCodes

#### тЭМ р╣Ар╕Бр╕бр╣Ар╕Кр╣Зр╕Др╕нр╕┤р╕Щ (`src/components/CheckinGame.tsx`)
- **р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ:** р╣Гр╕Кр╣Й Firebase transaction р╣Вр╕Фр╕вр╕Хр╕гр╕З
- **р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Й:**
  - р╣Гр╕Кр╣Й `postgresqlAdapter.claimDailyRewardCode(dayIndex)` р╕кр╕│р╕лр╕гр╕▒р╕Ъ dailyRewardCodes
  - р╣Гр╕Кр╣Й `postgresqlAdapter.claimCompleteRewardCode()` р╕кр╕│р╕лр╕гр╕▒р╕Ъ completeRewardCodes
  - р╣Гр╕Кр╣Й `postgresqlAdapter.claimCouponCode(itemIndex)` р╕кр╕│р╕лр╕гр╕▒р╕Ъ couponItemCodes

---

## ЁЯФН р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ

### тЬЕ р╣Ар╕Бр╕бр╕Чр╕▓р╕вр╕ар╕▓р╕Юр╕Ыр╕гр╕┤р╕ир╕Щр╕▓ (PuzzleGame)
- тЬЕ р╣Гр╕Кр╣Й `postgresqlAdapter.claimCode()` р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ claimedBy
- тЬЕ р╣Бр╕Ир╕Бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ъ

### тЬЕ р╣Ар╕Бр╕б Trick or Treat
- тЬЕ р╣Гр╕Кр╣Й `postgresqlAdapter.claimCode()` р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ claimedBy
- тЬЕ р╣Бр╕Ир╕Бр╕Хр╕▓р╕бр╕ер╕│р╕Фр╕▒р╕Ъ

---

## ЁЯУК р╕кр╕гр╕╕р╕Ы

### тЬЕ Backend
- тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З `/claim-code` р╣Гр╕лр╣Йр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╣Йр╕Фр╕Лр╣Йр╕│р╕гр╕░р╕лр╕зр╣Ир╕▓р╕З USER
- тЬЕ р╕кр╕гр╣Йр╕▓р╕З endpoints р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Вр╕Др╣Йр╕Фр╣Бр╕Ър╕Ър╕Юр╕┤р╣Ар╕ир╕й

### тЬЕ Frontend API
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б functions р╕кр╕│р╕лр╕гр╕▒р╕Ъ claimCode р╣Бр╕Ър╕Ър╕Юр╕┤р╣Ар╕ир╕й

### тП│ Frontend Components
- тП│ р╣Ар╕Бр╕б BINGO - р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕В
- тП│ р╣Ар╕Бр╕бр╕ер╕нр╕вр╕Бр╕гр╕░р╕Чр╕З - р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕В
- тП│ р╣Ар╕Бр╕бр╣Ар╕Кр╣Зр╕Др╕нр╕┤р╕Щ - р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕В

---

**ЁЯУМ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕:** Backend endpoints р╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з р╕Хр╣Йр╕нр╕Зр╣Бр╕Бр╣Йр╣Др╕В frontend components р╣Гр╕лр╣Йр╣Гр╕Кр╣Й backend endpoints р╣Бр╕Чр╕Щ Firebase transaction

