# ğŸ”’ Security Test Guide - Check-in System

## ğŸ“‹ à¸ à¸²à¸à¸£à¸§à¸¡

à¹„à¸Ÿà¸¥à¹Œà¸—à¸”à¸ªà¸­à¸šà¸™à¸µà¹‰à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¸¶à¹‰à¸™à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆà¸•à¹ˆà¸²à¸‡à¹† à¹ƒà¸™à¸£à¸°à¸šà¸šà¹€à¸Šà¹‡à¸„à¸­à¸´à¸™à¸—à¸µà¹ˆà¹€à¸£à¸²à¹„à¸”à¹‰à¹à¸à¹‰à¹„à¸‚à¹„à¸›à¹à¸¥à¹‰à¸§

## ğŸš€ à¸§à¸´à¸˜à¸µà¹ƒà¸Šà¹‰à¸‡à¸²à¸™

### 1. à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸«à¸™à¹‰à¸² Test Security

à¹€à¸›à¸´à¸”à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¹à¸¥à¸°à¹„à¸›à¸—à¸µà¹ˆ:
```
http://localhost:5173/test-security
```
(à¸«à¸£à¸·à¸­ URL à¸‚à¸­à¸‡ development server à¸‚à¸­à¸‡à¸„à¸¸à¸“)

### 2. à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥

- **Game ID**: ID à¸‚à¸­à¸‡à¹€à¸à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š (à¹€à¸Šà¹ˆà¸™ `game-123`)
- **User ID**: User ID à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š (à¹€à¸Šà¹ˆà¸™ `TESTUSER`)
- **Day Index**: à¸§à¸±à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š (0 = Day 1, 1 = Day 2, ...)
- **Coin Amount**: à¸ˆà¸³à¸™à¸§à¸™ HENGCOIN à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸—à¸”à¸ªà¸­à¸š (default: 50)

### 3. à¸à¸”à¸›à¸¸à¹ˆà¸¡ "à¹€à¸£à¸´à¹ˆà¸¡à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š"

à¸£à¸°à¸šà¸šà¸ˆà¸°à¸£à¸±à¸™à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹à¸¥à¸°à¹à¸ªà¸”à¸‡à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ

## ğŸ§ª à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸—à¸µà¹ˆà¸„à¸£à¸­à¸šà¸„à¸¥à¸¸à¸¡

### Test 1: Duplicate Check-in Prevention
**à¸—à¸”à¸ªà¸­à¸š**: à¸à¸²à¸£à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™à¸‹à¹‰à¸³

**à¸§à¸´à¸˜à¸µà¸—à¸”à¸ªà¸­à¸š**:
- à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¥à¸­à¸‡à¸—à¸³ transaction à¸«à¸¥à¸²à¸¢à¸„à¸£à¸±à¹‰à¸‡à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™ (simulate race condition)
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™à¸‹à¹‰à¸³à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡**:
- âœ… à¸„à¸§à¸£à¸¡à¸µ transaction à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸„à¹ˆ 1 à¸„à¸£à¸±à¹‰à¸‡
- âŒ à¸–à¹‰à¸²à¸¡à¸µà¸¡à¸²à¸à¸à¸§à¹ˆà¸² 1 à¸„à¸£à¸±à¹‰à¸‡ = à¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ

### Test 2: Coin Transaction Validation
**à¸—à¸”à¸ªà¸­à¸š**: à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š transaction result à¸à¹ˆà¸­à¸™à¹ƒà¸«à¹‰à¸£à¸²à¸‡à¸§à¸±à¸¥ HENGCOIN

**à¸§à¸´à¸˜à¸µà¸—à¸”à¸ªà¸­à¸š**:
- à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¥à¸­à¸‡à¸—à¸³ coin transaction à¸«à¸¥à¸²à¸¢à¸„à¸£à¸±à¹‰à¸‡à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£à¹ƒà¸«à¹‰à¸£à¸²à¸‡à¸§à¸±à¸¥à¸‹à¹‰à¸³à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡**:
- âœ… à¸„à¸§à¸£à¹€à¸à¸´à¹ˆà¸¡ coin à¹à¸„à¹ˆ 1 à¸„à¸£à¸±à¹‰à¸‡
- âŒ à¸–à¹‰à¸²à¹€à¸à¸´à¹ˆà¸¡à¸¡à¸²à¸à¸à¸§à¹ˆà¸² 1 à¸„à¸£à¸±à¹‰à¸‡ = à¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ

### Test 3: Rollback on Coin Failure
**à¸—à¸”à¸ªà¸­à¸š**: à¸à¸²à¸£ rollback à¹€à¸¡à¸·à¹ˆà¸­ coin transaction à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§

**à¸§à¸´à¸˜à¸µà¸—à¸”à¸ªà¸­à¸š**:
- à¸£à¸°à¸šà¸šà¸ˆà¸° simulate checkin à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¹à¸•à¹ˆ coin transaction à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£ rollback checkin record à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡**:
- âš ï¸ à¸•à¹‰à¸­à¸‡à¸—à¸”à¸ªà¸­à¸š manual à¹‚à¸”à¸¢ simulate network error
- âœ… à¸„à¸§à¸£à¸¡à¸µà¸à¸²à¸£ rollback checkin record

### Test 4: Complete Reward Race Condition
**à¸—à¸”à¸ªà¸­à¸š**: à¸à¸²à¸£à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ complete reward race condition

**à¸§à¸´à¸˜à¸µà¸—à¸”à¸ªà¸­à¸š**:
- à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¥à¸­à¸‡à¸—à¸³ transaction à¸«à¸¥à¸²à¸¢à¸„à¸£à¸±à¹‰à¸‡à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£à¹€à¸„à¸¥à¸¡à¸£à¸²à¸‡à¸§à¸±à¸¥à¸‹à¹‰à¸³à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡**:
- âœ… à¸„à¸§à¸£à¸¡à¸µ transaction à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸„à¹ˆ 1 à¸„à¸£à¸±à¹‰à¸‡
- âŒ à¸–à¹‰à¸²à¸¡à¸µà¸¡à¸²à¸à¸à¸§à¹ˆà¸² 1 à¸„à¸£à¸±à¹‰à¸‡ = à¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ

### Test 5: Date Validation
**à¸—à¸”à¸ªà¸­à¸š**: à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¸±à¸™à¸—à¸µà¹ˆ

**à¸§à¸´à¸˜à¸µà¸—à¸”à¸ªà¸­à¸š**:
- à¸£à¸°à¸šà¸šà¸ˆà¸°à¸¥à¸­à¸‡à¹€à¸Šà¹‡à¸„à¸­à¸´à¸™à¸”à¹‰à¸§à¸¢à¸§à¸±à¸™à¸—à¸µà¹ˆà¸•à¹ˆà¸²à¸‡à¹†
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¸±à¸™à¸—à¸µà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

**à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡**:
- âœ… à¸„à¸§à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
- âŒ à¸–à¹‰à¸²à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸­à¸·à¹ˆà¸™ = à¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ

## âš ï¸ à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡

1. **à¸­à¸¢à¹ˆà¸²à¹ƒà¸Šà¹‰ User ID à¸ˆà¸£à¸´à¸‡à¸—à¸µà¹ˆà¸à¸³à¸¥à¸±à¸‡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™**
   - à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸ˆà¸° restore à¸ªà¸–à¸²à¸™à¸°à¹€à¸”à¸´à¸¡ à¹à¸•à¹ˆà¸„à¸§à¸£à¹ƒà¸Šà¹‰ test user

2. **à¸—à¸”à¸ªà¸­à¸šà¹ƒà¸™à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡ development à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™**
   - à¸­à¸¢à¹ˆà¸²à¹ƒà¸Šà¹‰à¹ƒà¸™ production

3. **Test 3 à¸•à¹‰à¸­à¸‡à¸—à¸”à¸ªà¸­à¸š manual**
   - à¸•à¹‰à¸­à¸‡ simulate network error à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸š rollback

4. **à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸ˆà¸°à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸ Firebase**
   - à¸£à¸°à¸§à¸±à¸‡à¸­à¸¢à¹ˆà¸²à¹ƒà¸Šà¹‰ Game ID à¸«à¸£à¸·à¸­ User ID à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸

## ğŸ“Š à¸à¸²à¸£à¸­à¹ˆà¸²à¸™à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ

### âœ… PASSED
- à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸œà¹ˆà¸²à¸™
- à¹„à¸¡à¹ˆà¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ

### âŒ FAILED
- à¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ
- à¸•à¹‰à¸­à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸¥à¸°à¹à¸à¹‰à¹„à¸‚

### âš ï¸ WARNING
- à¸•à¹‰à¸­à¸‡à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡
- à¸­à¸²à¸ˆà¸•à¹‰à¸­à¸‡à¸—à¸”à¸ªà¸­à¸š manual

## ğŸ” à¸à¸²à¸£ Debug

à¸–à¹‰à¸²à¸à¸šà¸Šà¹ˆà¸­à¸‡à¹‚à¸«à¸§à¹ˆ:

1. à¹€à¸›à¸´à¸” Browser Console à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹ log
2. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š `details` à¹ƒà¸™à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ
3. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Firebase Realtime Database
4. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹‚à¸„à¹‰à¸”à¹ƒà¸™ `CheckinGame.tsx`

## ğŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸

- à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸™à¸µà¹‰à¸ˆà¸° **restore à¸ªà¸–à¸²à¸™à¸°à¹€à¸”à¸´à¸¡** à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸—à¸”à¸ªà¸­à¸šà¹€à¸ªà¸£à¹‡à¸ˆ
- à¹à¸•à¹ˆà¸„à¸§à¸£à¹ƒà¸Šà¹‰ **test user** à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢
- à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸šà¸šà¸²à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¸­à¸²à¸ˆà¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ (à¸£à¸­ transaction)

## ğŸ› ï¸ à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹à¸šà¸š Programmatic

à¸„à¸¸à¸“à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸—à¸”à¸ªà¸­à¸šà¹‚à¸”à¸¢à¸•à¸£à¸‡à¹„à¸”à¹‰:

```typescript
import { runAllSecurityTests } from './utils/test-checkin-security'

const results = await runAllSecurityTests(
  'game-123',  // gameId
  'TESTUSER',  // userId
  0,           // dayIndex
  50           // coinAmount
)

results.forEach(result => {
  console.log(`${result.testName}: ${result.passed ? 'PASSED' : 'FAILED'}`)
})
```

## ğŸ“š à¹€à¸­à¸à¸ªà¸²à¸£à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡

- `src/utils/test-checkin-security.ts` - à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸—à¸”à¸ªà¸­à¸š
- `src/pages/TestCheckinSecurity.tsx` - UI à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸š
- `src/components/CheckinGame.tsx` - à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¸—à¸”à¸ªà¸­à¸š

