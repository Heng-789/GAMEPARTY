# üîç ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤ RTDB Download ‡∏™‡∏π‡∏á

## üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase Realtime Database ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î:

---

## üö® ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏ö

### 1. **CheckinGame - Listeners ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô** ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:** `src/components/CheckinGame.tsx`

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
1. **`useRealtimeData` 5 ‡∏ï‡∏±‡∏ß** (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏°‡∏µ listener ‡πÅ‡∏¢‡∏Å):
   - `hcoin` - `USERS_EXTRA/${user}/hcoin`
   - `checkin` - `checkins/${gameId}/${user}`
   - `completeReward` - `checkins/${gameId}/${user}/completeRewardClaimed`
   - `userStatus` - `USERS_EXTRA/${user}/status`
   - `completeRewardCode` - `checkins/${gameId}/${user}/completeRewardCode`

2. **`onValue` listeners ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°** (‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö useRealtimeData):
   - ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 529-553: Listen `checkins/${gameId}/${user}` **‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á** (‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö useRealtimeData)
   - ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 564-612: Listen `answers/${gameId}` **‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** ‚Üê **‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å!**

3. **‡∏Å‡∏≤‡∏£ Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ:**
   - ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 644-739: Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firestore ‡πÑ‡∏õ RTDB ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤

#### ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- `answers/${gameId}` ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà)
- Listen ‡∏ó‡∏±‡πâ‡∏á `answers` node ‡∏ó‡∏≥‡πÉ‡∏´‡πâ download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó
- ‡∏°‡∏µ listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏≥‡πÉ‡∏´‡πâ download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á

---

### 2. **BingoGame - Listeners ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà** ‚ö†Ô∏è‚ö†Ô∏è

**‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:** `src/components/BingoGame.tsx`

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
1. **Players Listener** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 484-526):
   - Listen `games/${gameId}/bingo/players` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 100 ‡∏Ñ‡∏ô = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100 ‡∏Ñ‡∏ô

2. **Cards Listener** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 570-639):
   - Listen `games/${gameId}/bingo/cards` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 100 ‡∏Ñ‡∏ô ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏°‡∏µ 1 ‡∏Å‡∏≤‡∏£‡πå‡∏î = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100 ‡∏Å‡∏≤‡∏£‡πå‡∏î
   - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏°‡∏µ `checkedNumbers` (5x5 array) = 25 booleans ‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πå‡∏î

3. **GameState Listener** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 878, 930):
   - ‡∏°‡∏µ 2 listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö gameState (‡∏≠‡∏≤‡∏à‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô)

#### ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó (‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ï‡∏¥‡πä‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡∏°‡πà
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 100 ‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÄ‡∏Å‡∏° ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏∏‡∏Å 300ms = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 100 ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏∏‡∏Å 300ms

---

### 3. **GamesList - Listen ‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** ‚ö†Ô∏è

**‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:** `src/pages/games/GamesList.tsx`

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 84-122: Listen `games` **‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏Å‡∏°‡πÉ‡∏î‡πÄ‡∏Å‡∏°‡∏´‡∏ô‡∏∂‡πà‡∏á = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

#### ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏Å‡∏° 100 ‡πÄ‡∏Å‡∏° = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100 ‡πÄ‡∏Å‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

---

### 4. **Presence System - Listen ‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏Å‡∏°** ‚ö†Ô∏è

**‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:** `src/services/realtime-presence.ts`

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 151-187: `listenToGamePresence` - Listen `presence/${gameId}/rooms` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å

---

### 5. **Coin Balance - ‡∏≠‡πà‡∏≤‡∏ô RTDB ‡∏ö‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å** ‚ö†Ô∏è

**‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:** `src/services/coin-firestore.ts`

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô RTDB balance ‡∏ö‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å‡πÉ‡∏ô transaction retry loops
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 125-131, 141, 146, 195-201: ‡∏≠‡πà‡∏≤‡∏ô RTDB balance ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô transaction retry

#### ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‡πÅ‡∏ï‡πà‡∏•‡∏∞ transaction ‡∏≠‡∏≤‡∏à‡∏≠‡πà‡∏≤‡∏ô RTDB ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏ñ‡πâ‡∏≤ retry)

---

## üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö

### ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ Download ‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á):

1. **ü•á CheckinGame - `answers/${gameId}` listener**
   - Download: **‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å** (listen ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó)
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (real-time)

2. **ü•à BingoGame - `cards` listener**
   - Download: **‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å** (listen ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ‡∏™‡∏π‡∏á (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡πä‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)

3. **ü•â CheckinGame - Multiple redundant listeners**
   - Download: **‡∏™‡∏π‡∏á** (listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô)
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á

4. **BingoGame - `players` listener**
   - Download: **‡∏™‡∏π‡∏á** (listen ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ‡∏™‡∏π‡∏á

5. **GamesList - `games` listener**
   - Download: **‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á-‡∏™‡∏π‡∏á** (listen ‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
   - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: ‡∏ï‡πà‡∏≥-‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á

---

## üí° ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. **‡πÅ‡∏Å‡πâ CheckinGame - `answers` listener** üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
```typescript
// ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Listen ‡∏ó‡∏±‡πâ‡∏á answers node
const answersRef = ref(db, `answers/${gameId}`)
const unsubscribe = onValue(answersRef, (snapshot) => {
  // Download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
})
```

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
1. **‡πÉ‡∏ä‡πâ Query ‡πÅ‡∏ó‡∏ô** - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
2. **‡πÉ‡∏ä‡πâ Firestore ‡πÅ‡∏ó‡∏ô** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö query ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
3. **‡∏•‡∏î‡∏Å‡∏≤‡∏£ listen** - Listen ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

```typescript
// ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤: Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á user
const answersRef = ref(db, `answers/${gameId}`)
const answersQuery = query(
  answersRef,
  orderByChild('user'),
  equalTo(user),
  limitToLast(30) // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 30 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
)
```

### 2. **‡πÅ‡∏Å‡πâ CheckinGame - ‡∏•‡∏î Listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô**

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- ‡∏°‡∏µ listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `checkins/${gameId}/${user}` 2 ‡∏ï‡∏±‡∏ß (useRealtimeData + onValue)

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‡∏•‡∏ö listener ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô ‡∏≠‡∏≠‡∏Å
- ‡πÉ‡∏ä‡πâ `useRealtimeData` ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å state

### 3. **‡πÅ‡∏Å‡πâ BingoGame - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á**

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
```typescript
// ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Listen ‡∏ó‡∏±‡πâ‡∏á cards node
const cardsRef = ref(db, `games/${gameId}/bingo/cards`)
const unsubscribe = onValue(cardsRef, (snapshot) => {
  // Download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
})
```

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
```typescript
// ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤: Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
const cardsRef = ref(db, `games/${gameId}/bingo/cards`)
const myCardsQuery = query(
  cardsRef,
  orderByChild('userId'),
  equalTo(userId),
  limitToLast(10) // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10)
)
```

### 4. **‡πÅ‡∏Å‡πâ GamesList - Cache ‡πÅ‡∏•‡∏∞ Update ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô**

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‡πÉ‡∏ä‡πâ cache ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
- ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Firestore ‡πÅ‡∏ó‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time updates ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤)

### 5. **‡πÄ‡∏û‡∏¥‡πà‡∏° Index Rules ‡πÉ‡∏ô Firebase**

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- ‡πÑ‡∏°‡πà‡∏°‡∏µ index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö query ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- ‡πÄ‡∏û‡∏¥‡πà‡∏° index rules ‡πÉ‡∏ô Firebase Console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:
  - `answers/${gameId}` - index by `user`, `ts`
  - `games/${gameId}/bingo/cards` - index by `userId`

---

## üéØ Priority ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. **üî• Critical (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡∏ô‡∏ó‡∏µ):**
   - CheckinGame - `answers` listener
   - BingoGame - `cards` listener

2. **‚ö†Ô∏è High (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ):**
   - CheckinGame - ‡∏•‡∏î listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
   - BingoGame - `players` listener

3. **üìä Medium (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤):**
   - GamesList - `games` listener
   - Presence system optimization

---

## ‚ö†Ô∏è ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. **CheckinGame - `answers` listener** ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô:
- **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:** `answers/${gameId}/${dateKey}/${ts}` ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ query by `user` ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
- **‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:**
  - ‚úÖ **Option 1:** Listen ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ dateKey ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 7 ‡∏ß‡∏±‡∏ô)
  - ‚úÖ **Option 2:** ‡πÉ‡∏ä‡πâ Firestore ‡πÅ‡∏ó‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö query ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤)
  - ‚úÖ **Option 3:** ‡∏™‡∏£‡πâ‡∏≤‡∏á index path ‡πÉ‡∏´‡∏°‡πà `answersByUser/${gameId}/${user}` (‡∏ï‡πâ‡∏≠‡∏á refactor)

#### ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‚ùå **AdminAnswers** - ‡πÉ‡∏ä‡πâ `onValue` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin)
  - **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡πÄ‡∏Å‡πá‡∏ö listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin ‡πÑ‡∏ß‡πâ (‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ)
- ‚úÖ **CheckinGame** - ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  - **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ:** Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ dateKey ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

---

### 2. **BingoGame - `cards` listener** ‚ö†Ô∏è‚ö†Ô∏è

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô:
- **‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Index:** ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á index `userId` ‡πÉ‡∏ô Firebase Console
- **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö:** ‡∏ñ‡πâ‡∏≤ query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô
  - **‡πÅ‡∏ï‡πà:** ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)

#### ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‚úÖ **BingoGame** - ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  - **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ:** Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (`orderByChild('userId').equalTo(userId)`)
- ‚ùå **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤:** ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô

---

### 3. **BingoGame - `players` listener** ‚ö†Ô∏è

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô:
- **‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:** UI ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **Query ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:** ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)

#### ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‚ö†Ô∏è **BingoGame** - ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ:** ‡πÄ‡∏Å‡πá‡∏ö listener ‡πÑ‡∏ß‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° throttle/throttle ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
  - **‡∏´‡∏£‡∏∑‡∏≠:** ‡πÉ‡∏ä‡πâ pagination (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà active)

---

### 4. **CheckinGame - Listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô** ‚úÖ

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô:
- **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡∏•‡∏ö listener ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
- **‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:** ‡∏ß‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á listener ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

#### ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‚úÖ **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏•‡∏ö listener ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢

---

### 5. **GamesList - `games` listener** ‚ö†Ô∏è

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô:
- **‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:** UI ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **Query ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:** ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ

#### ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‚ö†Ô∏è **GamesList** - ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ:** ‡πÉ‡∏ä‡πâ cache ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô (‡πÉ‡∏ä‡πâ `onChildAdded`, `onChildChanged` ‡πÅ‡∏ó‡∏ô `onValue`)
  - **‡∏´‡∏£‡∏∑‡∏≠:** ‡πÉ‡∏ä‡πâ Firestore ‡πÅ‡∏ó‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time updates ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤)

---

## üéØ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Safe Implementation Plan)

### Phase 1: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ 100% (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö) ‚úÖ

1. **‡∏•‡∏ö listeners ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡πÉ‡∏ô CheckinGame**
   - ‡∏•‡∏ö `onValue` listener ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö `useRealtimeData`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡πÑ‡∏°‡πà‡∏°‡∏µ

2. **‡πÄ‡∏û‡∏¥‡πà‡∏° throttle/throttle ‡πÉ‡∏´‡πâ listeners**
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° throttle ‡πÉ‡∏´‡πâ `players` ‡πÅ‡∏•‡∏∞ `cards` listeners
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡πÑ‡∏°‡πà‡∏°‡∏µ (‡πÅ‡∏Ñ‡πà‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó)

### Phase 2: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö) ‚ö†Ô∏è

1. **BingoGame - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á**
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á index `userId` ‡πÉ‡∏ô Firebase Console
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
   - **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

2. **CheckinGame - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ dateKey ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£**
   - Listen ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ dateKey ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 7-30 ‡∏ß‡∏±‡∏ô
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤ (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
   - **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### Phase 3: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á refactor (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏°‡∏≤‡∏Å) üî¥

1. **CheckinGame - ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Firestore**
   - ‡∏ï‡πâ‡∏≠‡∏á refactor ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏≠‡∏≤‡∏à‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô
   - **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:** ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

2. **GamesList - ‡πÉ‡∏ä‡πâ onChildAdded/onChildChanged**
   - ‡∏ï‡πâ‡∏≠‡∏á refactor listener logic
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏≠‡∏≤‡∏à‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
   - **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

---

### 6. **CreateGame - `USERS_EXTRA` listener** ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

**‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:** `src/pages/CreateGame.tsx` ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 552

#### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:
- **Listen `USERS_EXTRA` ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ user 1000 ‡∏Ñ‡∏ô = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 1000 ‡∏Ñ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ user ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ CreateGame

#### ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:
- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó balance ‡∏Ç‡∏≠‡∏á user ‡πÉ‡∏î user ‡∏´‡∏ô‡∏∂‡πà‡∏á = download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 1000 user ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó balance ‡∏ö‡πà‡∏≠‡∏¢ = download ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å

---

## üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô USERS_EXTRA ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
```
USERS_EXTRA/
  {userId}/
    hcoin: number        // Balance
    password: string     // Password
    status?: string      // Status
```

### ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ USERS_EXTRA:

1. **‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ user):**
   - `UserBar.tsx` - Listen `USERS_EXTRA/${username}` ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
   - `CheckinGame.tsx` - Listen `USERS_EXTRA/${user}/hcoin` ‡πÅ‡∏•‡∏∞ `USERS_EXTRA/${user}/status` ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
   - ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏ä‡πâ `get()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ user

2. **‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Listen ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):**
   - `CreateGame.tsx` ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 552 - Listen `USERS_EXTRA` **‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ user ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

3. **üìù ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:**
   - ‡πÉ‡∏ä‡πâ **Firestore transaction** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö coin transactions (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô race condition)
   - **Sync balance** ‡πÑ‡∏õ RTDB ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ real-time listener ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
   - Balance **source of truth** = Firestore
   - RTDB = ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö real-time listener ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

---

## üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: USERS_EXTRA ‡∏Ñ‡∏ß‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Firestore ‡πÑ‡∏´‡∏°?

### ‚úÖ **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Firestore**

#### ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:

1. **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ Firestore ‡πÄ‡∏õ‡πá‡∏ô source of truth ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß:**
   - `coin-firestore.ts` ‡πÉ‡∏ä‡πâ Firestore transaction ‡πÄ‡∏û‡∏∑‡πà‡∏≠ lock ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó balance
   - Balance ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô `coin_balances/${userId}` ‡πÉ‡∏ô Firestore
   - RTDB ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà sync balance ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

2. **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Firestore:**
   - ‚úÖ **Query ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö query ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ balance ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î, query ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç)
   - ‚úÖ **Security Rules ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤** - Firestore Security Rules ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤ RTDB
   - ‚úÖ **‡∏•‡∏î Download** - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ RTDB
   - ‚úÖ **Real-time Updates** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listener ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

3. **‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:**
   - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á Refactor** - ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ RTDB listener
   - ‚ö†Ô∏è **Migration** - ‡∏ï‡πâ‡∏≠‡∏á migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏≤‡∏Å RTDB ‡πÑ‡∏õ Firestore

---

## üéØ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢ USERS_EXTRA ‡πÑ‡∏õ Firestore

### Phase 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Firestore Structure (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î) ‚úÖ

1. **‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore:**
   ```
   users/
     {userId}/
       hcoin: number
       password: string
       status?: string
       createdAt: timestamp
       updatedAt: timestamp
   ```

2. **Migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤:**
   - ‡∏™‡∏£‡πâ‡∏≤‡∏á script ‡πÄ‡∏û‡∏∑‡πà‡∏≠ migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å RTDB ‡πÑ‡∏õ Firestore
   - ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô RTDB ‡πÑ‡∏ß‡πâ (backward compatibility)

### Phase 2: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Firestore (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö RTDB) ‚ö†Ô∏è

1. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `coin-firestore.ts`:**
   - ‡πÄ‡∏Å‡πá‡∏ö balance ‡πÉ‡∏ô Firestore `users/${userId}/hcoin` ‡πÅ‡∏ó‡∏ô `coin_balances/${userId}`
   - ‡∏¢‡∏±‡∏á sync ‡πÑ‡∏õ RTDB ‡πÑ‡∏ß‡πâ (backward compatibility)

2. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `UserBar.tsx`:**
   - ‡πÉ‡∏ä‡πâ Firestore listener ‡πÅ‡∏ó‡∏ô RTDB listener
   - ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ `useRealtimeData` hook ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Firestore

3. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `CheckinGame.tsx`:**
   - ‡πÉ‡∏ä‡πâ Firestore listener ‡πÅ‡∏ó‡∏ô RTDB listener

4. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `CreateGame.tsx`:**
   - **‡πÉ‡∏ä‡πâ Firestore query** ‡πÅ‡∏ó‡∏ô listen ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ balance ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 100 ‡∏Ñ‡∏ô)

### Phase 3: ‡∏•‡∏ö RTDB Sync (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß) üî¥

1. **‡∏•‡∏ö‡∏Å‡∏≤‡∏£ sync ‡πÑ‡∏õ RTDB:**
   - ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà sync balance ‡πÑ‡∏õ RTDB ‡πÉ‡∏ô `coin-firestore.ts`
   - ‡∏•‡∏ö listener ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ RTDB

2. **‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô RTDB:**
   - ‡∏•‡∏ö `USERS_EXTRA` ‡πÉ‡∏ô RTDB (‡∏´‡∏•‡∏±‡∏á migrate ‡πÄ‡∏™‡∏£‡πá‡∏à)

---

## üìù ‡∏™‡∏£‡∏∏‡∏õ

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà RTDB download ‡∏™‡∏π‡∏á:**
1. **Listen ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** (answers, cards, USERS_EXTRA) ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô
2. **Listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô** ‡∏ó‡∏≥‡πÉ‡∏´‡πâ download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á
3. **‡πÑ‡∏°‡πà‡∏°‡∏µ query filtering** ‡∏ó‡∏≥‡πÉ‡∏´‡πâ download ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏•‡∏±‡∏Å:**
- ‡πÉ‡∏ä‡πâ `query()` + `orderByChild()` + `equalTo()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏•‡∏î listeners ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
- ‡πÉ‡∏ä‡πâ cache ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
- **‡∏¢‡πâ‡∏≤‡∏¢ USERS_EXTRA ‡πÑ‡∏õ Firestore** (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ - ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ Firestore ‡πÄ‡∏õ‡πá‡∏ô source of truth ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- ‚úÖ **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å Phase 1** (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ 100%) - ‡∏•‡∏ö listeners ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô, ‡πÄ‡∏û‡∏¥‡πà‡∏° throttle
- ‚ö†Ô∏è **‡∏ó‡∏î‡∏™‡∏≠‡∏ö Phase 2** ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
- üî¥ **Phase 3** ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î - ‡∏¢‡πâ‡∏≤‡∏¢ USERS_EXTRA ‡πÑ‡∏õ Firestore
