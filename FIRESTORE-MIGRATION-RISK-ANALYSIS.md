# ‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: ‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ Firestore

## üìã ‡∏™‡∏£‡∏∏‡∏õ

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ **Firestore** ‡πÅ‡∏ó‡∏ô RTDB ‡∏à‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏¢‡∏π‡πà **‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ** ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£ migration ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

## üö® ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏´‡∏•‡∏±‡∏Å

### 1. **‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á Real-time ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Firestore ‡πÑ‡∏î‡πâ** ‚úÖ

#### ‚úÖ **‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners):**

1. **BingoGame - Game State** (`games/${gameId}/bingo/gameState`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `onValue()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

2. **BingoGame - Players** (`games/${gameId}/bingo/players`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `onValue()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

3. **BingoGame - Cards** (`games/${gameId}/bingo/cards`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `onValue()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore + Query filter (`where('userId', '==', userId)`)
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö query filter ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ RTDB
   - **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:** ‡∏•‡∏î download (query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)

4. **LiveChat** (`chat/${gameId}`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `onValue()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore collection `chat/{gameId}/messages`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB
   - **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:** Query ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (limit, orderBy)

5. **UserBar - Credit** (`USERS_EXTRA/${username}/hcoin`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `onValue()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore `users/${username}`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

6. **CheckinGame - Balance & Status** (`USERS_EXTRA/${user}/*`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `useRealtimeData()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore `users/${user}`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

7. **Presence System** (`presence/${gameId}/rooms/*`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** `onValue()` ‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** `onSnapshot()` ‡πÉ‡∏ô Firestore collection `presence/{gameId}/rooms/{roomId}/users`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

---

### 2. **‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤** ‚ö†Ô∏è

#### ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á (‡∏ï‡πâ‡∏≠‡∏á migration ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö):**

1. **CreateGame - USERS_EXTRA Listener** (`USERS_EXTRA`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** Listen ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** Firestore query `collection('users').orderBy('hcoin', 'desc').limit(100)`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** 
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á index** ‡πÉ‡∏ô Firestore Console (`hcoin` descending)
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á migration** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å RTDB ‡πÑ‡∏õ Firestore
     - ‚úÖ **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:** Query ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á download ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)

2. **GamesList - Games Listener** (`games`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** Listen ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô RTDB
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** Firestore query `collection('games').orderBy('createdAt', 'desc')`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á index** ‡πÉ‡∏ô Firestore Console
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á migration** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     - ‚úÖ **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:** Query ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤

3. **CheckinGame - Answers Listener** (`answers/${gameId}`)
   - **‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:** Listen ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô RTDB (sharding ‡∏ï‡∏≤‡∏° dateKey)
   - **‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ:** Firestore query `collection('answers').where('gameId', '==', gameId).where('user', '==', user).orderBy('ts', 'desc').limit(30)`
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á composite index** ‡πÉ‡∏ô Firestore Console
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á migration** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
     - ‚úÖ **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:** Query ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

---

### 3. **‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏ç‡πà** üî¥

#### üî¥ **‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏°‡∏≤‡∏Å (‡∏ï‡πâ‡∏≠‡∏á refactor ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î):**

1. **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á:**
   - **RTDB:** Nested structure (`answers/${gameId}/${dateKey}/${ts}`)
   - **Firestore:** Flat structure (`answers/{docId}` with fields)
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á refactor** ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á migration** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö** ‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

2. **Query Patterns ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á:**
   - **RTDB:** `orderByChild().equalTo()` (simple)
   - **Firestore:** `where().orderBy()` (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ index)
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á indexes** ‡πÉ‡∏ô Firestore Console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å query
     - ‚ö†Ô∏è **‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö** query performance

3. **Real-time Performance:**
   - **RTDB:** Real-time ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (connection-based)
   - **Firestore:** Real-time ‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô indexes
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
     - ‚ö†Ô∏è **‡∏≠‡∏≤‡∏à‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö queries ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
     - ‚úÖ **‡πÅ‡∏ï‡πà‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö queries ‡∏ó‡∏µ‡πà filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

---

## üìä ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£ Migration ‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

### Phase 1: Dual Write (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡πà) ‚úÖ

**‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:** 1-2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå

1. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á RTDB ‡πÅ‡∏•‡∏∞ Firestore:**
   - ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore (source of truth)
   - Sync ‡πÑ‡∏õ RTDB (backward compatibility)
   - ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Firestore (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å RTDB

2. **Migration Script:**
   - Migrate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏≤‡∏Å RTDB ‡πÑ‡∏õ Firestore
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

3. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:**
   - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ real-time listeners ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡πÑ‡∏°‡πà‡∏°‡∏µ** - ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡πà)

---

### Phase 2: Dual Read (‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Firestore ‡∏Å‡πà‡∏≠‡∏ô) ‚ö†Ô∏è

**‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:** 1-2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå

1. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Firestore ‡∏Å‡πà‡∏≠‡∏ô:**
   - ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Firestore (primary)
   - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠ error ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å RTDB (fallback)

2. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:**
   - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ fallback ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡∏ï‡πà‡∏≥** - ‡∏ñ‡πâ‡∏≤ Firestore ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ (fallback ‡πÑ‡∏õ RTDB)

---

### Phase 3: Firestore Only (‡∏•‡∏ö RTDB) üî¥

**‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:** 1-2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå

1. **‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô RTDB:**
   - ‡∏•‡∏ö listeners ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ RTDB
   - ‡∏•‡∏ö sync code
   - ‡πÉ‡∏ä‡πâ Firestore ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

2. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:**
   - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö performance

3. **‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• RTDB:**
   - ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô RTDB (‡∏´‡∏•‡∏±‡∏á migrate ‡πÄ‡∏™‡∏£‡πá‡∏à)

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡∏™‡∏π‡∏á** - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏ï‡πâ‡∏≠‡∏á rollback ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Phase 2

---

## üéØ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### ‚úÖ **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô Phase**

1. **Phase 1 (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ 100%):**
   - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç listeners ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
   - ‡πÄ‡∏û‡∏¥‡πà‡∏° throttle/throttle
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡πÑ‡∏°‡πà‡∏°‡∏µ

2. **Phase 2 (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á):**
   - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ RTDB)
   - ‡∏•‡∏î listeners ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏ï‡πà‡∏≥ (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö)

3. **Phase 3 (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏°‡∏≤‡∏Å):**
   - Dual Write (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á RTDB ‡πÅ‡∏•‡∏∞ Firestore)
   - Migration ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô)

4. **Phase 4 (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏°‡∏≤‡∏Å):**
   - Dual Read (‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Firestore ‡∏Å‡πà‡∏≠‡∏ô)
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏ï‡πà‡∏≥ (‡∏°‡∏µ fallback)

5. **Phase 5 (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏°‡∏≤‡∏Å):**
   - Firestore Only (‡∏•‡∏ö RTDB)
   - **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** ‡∏™‡∏π‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏ï‡πâ‡∏≠‡∏á rollback)

---

## üìù ‡∏™‡∏£‡∏∏‡∏õ

**‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Firestore:**

‚úÖ **‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:**
- ‚úÖ **Real-time listeners:** ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB
- ‚ö†Ô∏è **Migration:** ‡∏ï‡πâ‡∏≠‡∏á migration ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‚ö†Ô∏è **Refactor:** ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î
- ‚ö†Ô∏è **Indexes:** ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á indexes ‡πÉ‡∏ô Firestore Console
- ‚ö†Ô∏è **‡∏ó‡∏î‡∏™‡∏≠‡∏ö:** ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

‚úÖ **‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:**
- ‚úÖ **Query ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤** - Filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ RTDB
- ‚úÖ **‡∏•‡∏î Download** - Query ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
- ‚úÖ **Security Rules ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤** - Firestore Security Rules ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏ß‡πà‡∏≤
- ‚úÖ **Real-time ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô** - Firestore ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö real-time listeners ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô RTDB

‚úÖ **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**
- ‚úÖ **‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô Phase** - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- ‚úÖ **Dual Write/Read** - ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á RTDB ‡πÅ‡∏•‡∏∞ Firestore ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (backward compatibility)
- ‚úÖ **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î** - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö RTDB
- ‚úÖ **‡∏°‡∏µ Rollback Plan** - ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏ú‡∏ô rollback ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

---

## üîÑ ‡πÅ‡∏ú‡∏ô Rollback

‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô Phase 3-5:

1. **Rollback ‡πÑ‡∏õ Phase 2:**
   - ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ RTDB ‡πÄ‡∏õ‡πá‡∏ô primary
   - ‡πÄ‡∏Å‡πá‡∏ö Firestore ‡πÑ‡∏ß‡πâ (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏•‡∏ö)

2. **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤:**
   - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç bugs ‡∏ó‡∏µ‡πà‡∏û‡∏ö
   - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

3. **Deploy ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á:**
   - Deploy Phase 3-5 ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

**‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö:** **‡∏ï‡πà‡∏≥** - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ rollback ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
